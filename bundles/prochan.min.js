(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.prochan=t()}})(function(){var t,e,n;return function r(t,e,n){function i(u,o){if(!e[u]){if(!t[u]){var l=typeof require=="function"&&require;if(!o&&l)return l(u,!0);if(s)return s(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var c=e[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n?n:e)},c,c.exports,r,t,e,n)}return e[u].exports}var s=typeof require=="function"&&require;for(var u=0;u<n.length;u++)i(n[u]);return i}({1:[function(t,e,n){(function(){var t;e.exports=t=function(){function t(){this.awaitee=null;this._prev=null;this._next=null;this.value=void 0;this.isFinal=false}t.prototype.block=function(t,e){};t.prototype.proceed=function(t,e){};return t}()}).call(this)},{}],2:[function(t,e,n){(function(){var n,r,i=function(t,e){for(var n in e){if(s.call(e,n))t[n]=e[n]}function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r;t.__super__=e.prototype;return t},s={}.hasOwnProperty;r=t("./queue");e.exports=n=function(){var t,e,n;t=8;e=4;n=t|e;function s(e,i){this.size=e;this.flags=this.size>0?t:n;this.queue=this.size!=null?new r:void 0;this.transform=typeof i==="function"?i(this):void 0;this.channel=null}s.prototype["@@transducer/result"]=function(t){return t};s.prototype["@@transducer/step"]=function(t,e){t.queue.enqueue(e);return t};s.prototype.isEmpty=function(){return this.queue.length===0};s.prototype.isFull=function(){return this.queue.length>=this.size};s.prototype.ingest=function(t){var e;if(this.transform!=null){e=this.transform["@@transducer/step"](this,t);if(e!=null?e["@@transducer/reduced"]:void 0){this.channel.close()}return e}else{this.queue.enqueue(t);return t}};s.prototype.update=function(){this.flags=(this.isEmpty()?t:0)|(this.isFull()?e:0);this.channel.flags=this.channel.flags&~n|this.flags&n};s.prototype.close=function(){var t;if((t=this.transform)!=null){t["@@transducer/result"](this)}};s.prototype.enqueue=function(t){if(!(!this.isFull()||this.size===0)){throw new Error}this.ingest(t);this.update();return true};s.prototype.dequeue=function(){var t;if(!!this.isEmpty()){throw new Error}t=this.queue.dequeue();this.update();return t};s.Sliding=function(t){i(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.isFull=function(){return false};e.prototype.enqueue=function(t){this.ingest(t);while(this.queue.length>this.size){this.queue.dequeue()}this.update();return true};return e}(s);s.Dropping=function(t){i(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.isFull=function(){return false};e.prototype.enqueue=function(t){if(this.queue.length<this.size){this.ingest(t);this.update();return true}else{return false}};return e}(s);s.fixed=function(t,e){return new s(t,e)};s.sliding=function(t,e){return new s.Sliding(t,e)};s.dropping=function(t,e){return new s.Dropping(t,e)};return s}()}).call(this)},{"./queue":8}],3:[function(t,e,n){(function(){var n,r,i,s=function(t,e){for(var n in e){if(u.call(e,n))t[n]=e[n]}function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r;t.__super__=e.prototype;return t},u={}.hasOwnProperty;i=t("./helpers").pooled;n=t("./awaiter");e.exports=i(r=function(t){s(e,t);function e(t,n,r){e.__super__.constructor.apply(this,arguments);this.channel=t;this.fn=n;this.context=r}e.prototype.proceed=function(t,e){var n,r;r=(n=this.fn)!=null?n.call(this.context,this.channel,t,e):void 0;this.free();return r};return e}(n))}).call(this)},{"./awaiter":1,"./helpers":5}],4:[function(t,e,n){(function(){var n,r,i;i=t("./helpers").attenuate;n=t("./buffer");e.exports=r=function(){var t,e,r,s,u,o,l,a;a=0;t=16;e=8;r=4;l=2;o=1;function c(t,i){var s;this.id="ch"+ ++a;this.buffer=null;if(t!=null||i!=null){switch(typeof t){case"number":this.buffer=new n(t,i);break;case"string":this.buffer=n[t](1,i);break;case"function":i=t;this.buffer=new n(0,i);break;default:this.buffer=t!=null?t:new n(0,i)}this.buffer.channel=this}this.flags=((s=this.buffer)!=null?s.size:void 0)>0?e:e|r;this.head=null;this.tail=null;this.result=void 0}s=function(){function t(){}t=i("enqueue detain cancel canProcessSend isClosed close");t.prototype["in"]=function(){return this};return t}();u=function(){function t(){}t=i("dequeue detain cancel canProcessReceive isDone");t.prototype.out=function(){return this};return t}();c.prototype.stateIsValid=function(){return 1<<this.flags&286356305};c.prototype.canProcessSend=function(){return 1<<this.flags&8961};c.prototype.canProcessReceive=function(){return 1<<this.flags&1130577};c.prototype.isClosed=function(){return 1<<this.flags&286326784};c.prototype.isDone=function(){return 1<<this.flags&285212672};c.prototype["in"]=function(){return new s(this)};c.prototype.out=function(){return new u(this)};c.prototype.close=function(e){var n;switch(this.flags){case 0:case 4:case 8:case 12:break;case 6:case 14:while(this.head){this.dispatch(false,true)}break;case 9:case 13:if(this.buffer!=null){while(this.head){this.dispatch(this.buffer.dequeue(),false)}}while(this.head){this.dispatch(e,true)}break;case 16:case 20:case 24:case 28:return;default:throw new Error("Invalid channel state")}if((n=this.buffer)!=null){n.close()}this.flags=this.flags&~(l|o)|t;return this.result=e};c.prototype.enqueue=function(t,e){switch(this.flags){case 0:case 8:this.buffer.enqueue(e);return t.value=true;case 4:case 6:case 12:case 14:this.detain(t,e);return false;case 9:case 13:if(this.buffer!=null){this.buffer.enqueue(e);while(!this.stateIsValid()){this.dispatch(this.buffer.dequeue(),false)}}else{this.dispatch(e,false)}return t.value=true;case 16:case 20:case 24:case 28:return t.value=false;default:throw new Error("Invalid channel state")}};c.prototype.dequeue=function(t){var e;switch(this.flags){case 0:case 4:case 16:case 20:e=this.buffer.dequeue(this);break;case 6:e=this.buffer.dequeue(this);while(!this.stateIsValid()){this.buffer.enqueue(this.dispatch(true,false))}break;case 8:case 9:case 12:case 13:this.detain(t);break;case 14:if(this.buffer!=null){while(this.flags===14){this.buffer.enqueue(this.dispatch(true,false))}return this.dequeue(t)}else{e=this.dispatch(true,false)}break;case 24:case 28:if(this.buffer!=null){this.buffer.free();this.buffer=null}e=this.result;break;default:throw new Error("Invalid channel state")}return t.value=e};c.prototype.detain=function(t,e){this.flags|=arguments.length<2?o:l;this.tail=(t._prev=this.tail)?this.tail._next=t:this.head=t;return t.block(this,e)};c.prototype.dispatch=function(t,e){var n;n=this.head;if(this.head=n._next){this.head._prev=n._next=null}else{this.tail=null;this.flags&=~(l|o)}return n.proceed(t,e)};c.prototype.cancel=function(t){var e,n;n=t._prev,e=t._next;if(t===this.head){if(!(this.head=e)){this.flags&=~(l|o)}}else{if(n!=null){n._next=e}}if(t===this.tail){this.tail=n}else{if(e!=null){e._prev=n}}return t._prev=t._next=null};c.prototype.toString=function(){var t,e,n,r,i,s,u,o,l,a,c;return"[object Channel] {\n  id:     "+this.id+"\n  state:  "+this.flagsToString()+"\n  buffer: "+((t=typeof buffer!=="undefined"&&buffer!==null?(e=buffer.queue)!=null?e.length:void 0:void 0)!=null?t:null)+"/"+((r=typeof buffer!=="undefined"&&buffer!==null?buffer.size:void 0)!=null?r:null)+"\n  head:   "+((i=(s=(u=this.head)!=null?u.id:void 0)!=null?s:(o=this.head)!=null?o.constructor.name:void 0)!=null?i:null)+"\n  tail:   "+((l=(a=(c=this.tail)!=null?c.id:void 0)!=null?a:(n=this.tail)!=null?n.constructor.name:void 0)!=null?l:null)+"\n}"};c.prototype.flagsToString=function(){var n,i,s,u;n={CLOSED:t,EMPTY:e,FULL:r,PUSHED:l,PULLED:o};s=function(){var t;t=[];for(i in n){u=n[i];if(this.flags&u){t.push(i)}}return t}.call(this).join(" | ");return"("+s+")"};c.prototype.direction=function(){switch(this.flags&(l|o)){case 0:return"";case l:return"->";case o:return"<-";default:return"!!"}};return c}()}).call(this)},{"./buffer":2,"./helpers":5}],5:[function(t,e,n){(function(){var t=[].slice;e.exports=function(){var e,n,r;n=Object.prototype.hasOwnProperty;return{isArray:(r=Array.isArray)!=null?r:function(t){return t!=null&&typeof t==="object"&&typeof t.splice==="function"&&typeof t.length===number},alias:function(){var e,r,i,s,u,o,l,a,c,f;u=arguments[0],l=2<=arguments.length?t.call(arguments,1):[];for(e=0,i=l.length;e<i;e++){o=l[e];for(c in u){f=u[c];if(n.call(o,c)){a=f.split(/\s+/);for(r=0,s=a.length;r<s;r++){f=a[r];if(!n.call(o,f)){o[f]=o[c]}}}}}},pooled:function(t){t.POOL_SIZE=4096;t.pool=[];t.alloc=function(){var t;if(!n.call(this,"pool")){this.pool=[]}t=this.pool.pop()||new this;this.apply(t,arguments);return t};t.prototype.free=function(){var e,n,r,i;e=function(){var t;t=this.constructor;t.apply(this,arguments);if(t.pool.length<t.POOL_SIZE){return t.pool.push(this)}};i=(n=(r=t.__super__)!=null?r:typeof t.prototype==="function"?t.prototype(t.prototype):void 0)!=null?n.free:void 0;if(i!=null){return function(){i.apply(this,arguments);return e.apply(this,arguments)}}else{return e}}();return t},attenuate:function(t){var e,n,r,i,s;if(typeof t==="string"){t=t.split(/\s+/)}r={};for(n=0,i=t.length;n<i;n++){s=t[n];r[s]=true}return e=function(){var e,n,i;function u(t){this["@@attenuator"]=function(e,n){var i;if(r[e]==null){throw new TypeError}i=t[e].apply(t,n);if(i===t){return this}else{return i}}}e=function(t){return u.prototype[t]=function(){return this["@@attenuator"](t,arguments)}};for(n=0,i=t.length;n<i;n++){s=t[n];e(s)}return u}()},AbstractGenerator:e=function(){function t(){this._result={value:void 0,done:false};this._step=0}t.prototype["yield"]=function(t){this._result.value=t;return this._result};t.prototype.next=function(){return this["return"]()};t.prototype["return"]=function(t){this._result.done=true;return this["yield"](t)};t.prototype["throw"]=function(t){throw t};return t}()}}()}).call(this)},{}],6:[function(t,e,n){(function(){var n,r,i,s=function(t,e){for(var n in e){if(u.call(e,n))t[n]=e[n]}function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r;t.__super__=e.prototype;return t},u={}.hasOwnProperty;n=t("./awaiter");i=t("./helpers").pooled;e.exports=r=function(t){s(e,t);function e(t,n,r,i){e.__super__.constructor.apply(this,arguments);this.selector=t;this.consequent=n;this.channel=r;this.value=i}e.prototype.proceed=function(t,e){return this.selector.proceedWith(this,t,e)};e.prototype.free=function(){return this.channel.cancel(this)};i(e.Receive=function(t){s(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.type="receive";e.prototype.isReady=function(){return this.channel.canProcessReceive()};e.prototype.detain=function(){return this.channel.detain(this)};return e}(e));i(e.Send=function(t){s(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.type="send";e.prototype.isReady=function(){return this.channel.canProcessSend()};e.prototype.detain=function(){return this.channel.detain(this,this.value)};return e}(e));return e}(n)}).call(this)},{"./awaiter":1,"./helpers":5}],7:[function(t,e,n){(function(){var n,r,i,s,u=function(t,e){for(var n in e){if(o.call(e,n))t[n]=e[n]}function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r;t.__super__=e.prototype;return t},o={}.hasOwnProperty;n=t("./awaiter");r=t("./channel");s=t("./queue");e.exports=i=function(t){var e,n,i,o,l,a,c,f,h,p,d,g,v,y,w;u(b,t);o=1;a=2;l=4;n=8;c=16;i=32;e=1024;w=0;p=null;h=null;y={};g=new s;function b(t,e){var n;b.__super__.constructor.apply(this,arguments);this.id="p"+ ++w;if(this.parent=p){((n=this.parent).children!=null?n.children:n.children={})[this.id]=this}this.children=null;this.flags=o;if(typeof t==="function"){t=t.apply(this,e)}if(typeof t.next!=="function"){throw new Error("Invalid generator")}this.iterator=t;this.cin=null;this.cout=null;y[this.id]=this}v=function(t){t.flags=a;g.enqueue(t);if(h==null){h=setImmediate(f)}};f=function(){var t;t=0;while(g.length){d(g.dequeue());if(++t>=e){break}}h=g.length?setImmediate(f):null};d=function(t){var e,n,r,i;if(t.flags&c){return}if(~t.flags&a){t["throw"]()}t.flags=l;p=t;try{while(true){r=t.iterator.next(t.value),i=r.value,e=r.done;if(e){t.exit(i)}if(~t.flags&l){break}}}catch(s){n=s;t.kill(n)}finally{p=null}};b.spawn=function(t,e){var n;if(arguments.length===0){throw new Error("Arity")}n=new b(t,e);n.proceed();return n};b.current=function(){if((p!=null?p.flags:void 0)&l){return p}else{return b["throw"]("Not in process",p)}};b["throw"]=function(t,e){if(t==null){t="<no message>"}if(e!=null){t=t+"\n---\nProcess:  "+e.id+"\nState:    ("+e.flagsToString()+")"}throw new Error(t)};b.dump=function(t){var e,n;if(t==null){t="list"}switch(t){case"list":return function(){var t;t=[];for(e in y){n=y[e];t.push(n.toString())}return t}().join("\n");case"tree":return function(){var t;t=[];for(e in y){n=y[e];if(n.parent===null){t.push(n.toTree())}}return t}().join("")}};b.prototype["throw"]=function(t){return b["throw"](t,this)};b.prototype._in=function(){return this.cin!=null?this.cin:this.cin=new r};b.prototype._out=function(){return this.cout!=null?this.cout:this.cout=new r};b.prototype["in"]=function(){return this._in()["in"]()};b.prototype.out=function(){return this._out().out()};b.prototype.canProcessReceive=function(){var t;return!!((t=this.cin)!=null?t.canProcessReceive():void 0)};b.prototype.canProcessSend=function(){var t;return!!((t=this.cout)!=null?t.canProcessSend():void 0)};b.prototype.isClosed=function(){var t;return!!((t=this.cin)!=null?t.isClosed():void 0)};b.prototype.isDone=function(){var t;return!!((t=this.cout)!=null?t.isDone():void 0)};b.prototype.enqueue=function(t,e){var n;if(this.flags&c){return t.value=false}else{return(n=this._in()).enqueue.apply(n,arguments)}};b.prototype.dequeue=function(t){var e;if(this.flags&c){return t.value=this.value}else{return(e=this._out()).dequeue.apply(e,arguments)}};b.prototype.isScheduled=function(){return!!(this.flags&a)};b.prototype.isRunning=function(){return!!(this.flags&l)};b.prototype.isBlocked=function(){return!!(this.flags&n)};b.prototype.isTerminated=function(){return!!(this.flags&c)};b.prototype.block=function(t,e){this.awaitee=t;this.value=e;if(!(this.flags&l)){this["throw"]()}this.flags=n;return this};b.prototype.proceed=function(t,e){var r;if(e==null){e=false}if(!(this.flags&(o|n))){this["throw"]()}this.awaitee=null;r=this.value;this.value=t;this.isFinal=e;v(this);return r};b.prototype.exit=function(t){var e,n,r;if(this.children!=null){r=this.children;for(n in r){e=r[n];e.parent=null}this.children=null}return this.kill(null,t)};b.prototype.kill=function(t,e){var n,r,s,u,o,l;if(t==null){t=null}this.flags=c;if(t!=null){this.flags|=i;this.value=t}else{this.value=e}if((s=this.cin)!=null){s.close()}if((u=this.cout)!=null){u.close(e)}if(this.children!=null){o=this.children;for(r in o){n=o[r];n.kill(t,e)}}if((l=this.parent)!=null){delete l.children[this.id]}delete y[this.id];if(t!=null){console.log(t);throw t}return e};b.prototype.toString=function(){var t,e,n,r,i,s,u;return"[object Process] {\n  id:       "+this.id+"\n  state:    "+this.flagsToString()+"\n  parent:   "+((e=(n=this.parent)!=null?n.id:void 0)!=null?e:null)+"\n  children: ["+function(){var e;e=[];for(t in this.children){e.push(t)}return e}.call(this)+"]\n  I/O:      "+((r=(i=this.cin)!=null?i.id:void 0)!=null?r:null)+"/"+((s=(u=this.cout)!=null?u.id:void 0)!=null?s:null)+"\n}"};b.prototype.toTree=function(t){var e,n,r,i,s,u,o,l;if(t==null){t=0}l=""+"  ".repeat(t)+this.id+" "+this.flagsToString();if(this.awaitee!=null){l+=" "+this.awaitee.direction()+this.awaitee.id}if(this.cin!=null||this.cout!=null){l+=" ("+((r=(i=this.cin)!=null?i.id:void 0)!=null?r:null)+"/"+((s=(u=this.cout)!=null?u.id:void 0)!=null?s:null)+")"}l+="\n";o=this.children;for(e in o){n=o[e];l+=n.toTree(t+1)}return l};b.prototype.flagsToString=function(){var t,e,r,s,u;t={INCIPIENT:o,SCHEDULED:a,RUNNING:l,BLOCKED:n,TERMINATED:c,ERROR:i};r=0;s=function(){var n;r++;n=[];for(e in t){u=t[e];if(this.flags&u){n.push(e)}}return n}.call(this).join(" | ");if(r===1){return s}else{return"("+s+")"}};return b}(n)}).call(this)},{"./awaiter":1,"./channel":4,"./queue":8}],8:[function(t,e,n){(function(){var n,r;r=t("./helpers").pooled;e.exports=n=function(){var t;r(t=function(){t.SIZE=32;function t(e){this._prev=e||null;this._next=null;if(this.array==null){this.array=new Array(t.SIZE)}if(e!=null){e._next=this}}return t}());function e(){this.head=null;this.tail=null;this.length=0;this.offset=0}e.prototype.enqueue=function(e){var n;n=(this.offset+this.length)%t.SIZE;if(n===0){this.tail=t.alloc(this.tail)}if(this.length===0){this.head=this.tail}this.tail.array[n]=e;return++this.length};e.prototype.dequeue=function(){var e,n,r,i,s;if(this.length===0){return}i=this.offset,n=this.head;e=n.array;s=e[i];e[i]=void 0;if((this.offset=(i+1)%t.SIZE)===0){if(r=n._next){n.free();r._prev=null;this.head=r}}if(--this.length===0){this.offset=0;this.head.free();this.head=this.tail=null}return s};return e}()}).call(this)},{"./helpers":5}],9:[function(t,e,n){(function(){var n,r,i,s,u=[].slice;r=t("./process");n=t("./operation");s=t("./helpers").isArray;e.exports=i=function(){var t,e,i,o,l,a,c,f,h,p,d,g,v,y,w,b;a=n.Receive,c=n.Send;l=1;t=2;e=4;i=8;o=16;m.prototype[(typeof Symbol!=="undefined"&&Symbol!==null?Symbol.iterator:void 0)||"@@iterator"]=function(){return this};function m(){this.flags=l;this.process=r.current();this.operations=[];this.alternative=null;this.arbiter=null;this.delegate=null;this.value=void 0}v=function(t){return t[0]};w=function(t){return t[t.length-1]};b=function(t){return t[Math.random()*t.length|0]};d=function(t){if(typeof t==="function"){return t}else{return function(e,n){return{next:function(){return{value:{label:t,value:e,channel:n},done:true}}}}}};g=function(){var t;t=[];return g=function(){var e,n;e=1<=arguments.length?u.call(arguments,0):[];if(e.length){switch(typeof(w=e.pop())){case"function":n=w;break;case"string":n=d(w);break;default:e.push(w);n=d()}}t[0]=e;t[1]=n;return t}}();h=function(t,n,r){if(t.flags&e){throw new Error("Already committed")}t.flags|=e;if(n!=null){if(n.selector!==t){throw new Error("Foreign operation")}t.value=n.value;t.delegate=n.consequent(r,n.channel)}else{t.delegate=t.alternative()}f(t);t.alternative=null;t.arbiter=null};f=function(t){var e,n,r,i;i=t.operations;for(e=0,n=i.length;e<n;e++){r=i[e];r.free()}t.operations.length=0};y=function(t,e){var n;n=t.delegate.next(e);if(n.done){p(t)}return n};p=function(t){t.flags=i;t.process=null;t.delegate=null;return t.value=void 0};m.select=function(){var t,e,n,r,i,u,o;u=g.apply(null,arguments),i=u[0],t=u[1];o=new m;for(e=0,n=i.length;e<n;e++){r=i[e];if(s(r)){o.send(r,t)}else{o.receive(r,t)}}return o};m.select.receive=function(){var t;return(t=new m).receive.apply(t,arguments)};m.select.send=function(){var t;return(t=new m).send.apply(t,arguments)};m.select.first=function(){return(new m).arbitrate(v)};m.select.last=function(){return(new m).arbitrate(w)};m.prototype.receive=function(){var t,e,n,r,i,s,u;if(~this.flags&l){throw new Error}u=g.apply(null,arguments),e=u[0],n=u[1];for(r=0,i=e.length;r<i;r++){t=e[r];s=t.canProcessReceive();if(this.flags&o){if(s){this.operations.push(a.alloc(this,n,t))}}else{if(s){this.flags|=o;f(this)}this.operations.push(a.alloc(this,n,t))}}return this};m.prototype.send=function(){var t,e,n,r,i,s,u,a,h;if(~this.flags&l){throw new Error}u=g.apply(null,arguments),i=u[0],e=u[1];for(n=0,r=i.length;n<r;n++){a=i[n],t=a[0],h=a[1];s=t.canProcessSend();if(this.flags&o){if(s){this.operations.push(c.alloc(this,e,t,h))}}else{if(s){this.flags|=o;f(this)}this.operations.push(c.alloc(this,e,t,h))}}return this};m.prototype["else"]=function(e){if(~this.flags&l){throw new Error("Early")}this.flags&=~l;if(this.flags&t||this.alternative!=null){throw new Error("Late")}this.alternative=d(e);return this};m.prototype.arbitrate=function(e){if(this.flags&t||this.arbiter!=null){throw new Error("Late")}this.arbiter=e;return this};m.prototype.next=function(e){var n,r,i,s;if(~this.flags&t){this.flags=this.flags&~l|t;if(this.flags&o){i=(this.arbiter||b)(this.operations)}if(i!=null){if(i.type==="send"){e=!i.channel.isClosed()}h(this,i,e);return y(this,e)}else if(this.alternative){h(this);return y(this)}else{this.process.block(this);s=this.operations;for(n=0,r=s.length;n<r;n++){i=s[n];i.detain()}return{value:void 0,done:false}}}else{return y(this,e)}};m.prototype.proceedWith=function(e,n,r){h(this,e,n);this.flags|=t;this.process.value=this.value;return this.process.proceed(n,r)};return m}()}).call(this)},{"./helpers":5,"./operation":6,"./process":7}],10:[function(t,e,n){(function(){var n,r,i,s,u,o,l,a,c,f,h,p,d,g,v,y,w,b,m,_,q,E,k=[].slice;s=t("./process");i=t("./channel");n=t("./buffer");u=t("./selector");r=t("./callback");o=t("./helpers").alias;q=Array.prototype.slice;v=function(){var t;return t=s.spawn.apply(s,arguments)};v.async=function(){var t,e;t=function(){function t(t,e,n){this.generator=t;this.args=e;this.callback=n;this.step=0;this.result={value:void 0,done:false}}t.prototype.next=function(t){var e,n;switch(++this.step){case 1:n=y(v(this.generator,this.args));break;case 2:try{n=this.callback(null,t)}catch(r){e=r;this.callback(e)}this.result.done=true}this.result.value=n;return this.result};return t}();return e=function(e){return function(n){var r;r=function(){var n,r,i;n=2<=arguments.length?k.call(arguments,0,i=arguments.length-1):(i=0,[]),r=arguments[i++];return new t(e,n,r)};v(r,arguments)}}}();(function(){var t,e,n,r,i;t=function(t){return function(){var e;return(e=s.current())[t].apply(e,arguments)}};i="enqueue dequeue isClosed isDone canProcessReceive canProcessSend".split(/\s+/);for(e=0,n=i.length;e<n;e++){r=i[e];v[r]=t(r)}})();v.dump=s.dump;c=function(){var t;t=s.spawn.apply(s,arguments);return t.out()};l=function(t,e){var n;return n=new i(t,e)};w=["fixed","sliding","dropping"];for(f=0,h=w.length;f<h;f++){p=w[f];a=n[p];l[p]=function(t){return function(){var e,n;n=arguments[0],e=2<=arguments.length?k.call(arguments,1):[];return l.apply(null,[t(n)].concat(k.call(e)))}}(a)}l.single=function(t){var e,n;n=l(null,t);y.async(n,e=function(t,e){if(n.buffer!=null){n.buffer.close;n.buffer=null}n.flags|=8;return n.close(e)});return n};y=function(){var t,e;e=s.current();switch(arguments.length){case 0:t=e._in();break;case 1:t=arguments[0];break;default:throw new Error("Arity")}return t.dequeue(e)};y.async=function(t,e){var n,i,s;n=r.alloc(t,e);i=t.canProcessReceive();s=t.dequeue(n);if(i){n.proceed(s,t.isDone())}return s};m=function(){var t,e,n;e=s.current();switch(arguments.length){case 1:n=arguments[0];t=e._out();break;case 2:t=arguments[0],n=arguments[1];break;default:throw new Error("Arity")}return t.enqueue(e,n)};m.async=function(t,e,n){var i,s,u;i=r.alloc(t,n);s=t.canProcessSend();u=t.enqueue(i,e);if(s){i.proceed(u,t.isClosed())}return u};b=u.select;g=function(){var t;switch(arguments.length){case 0:t=s.current()._in();break;case 1:t=arguments[0];break;default:throw new Error("Arity")}if(t.canProcessReceive()){return y.async(t)}};d=function(){var t,e;switch(arguments.length){case 1:e=arguments[0];t=s.current()._out();break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("Arity")}if(t.canProcessSend()){return m.async(t,e)}else{return false}};E=function(){var t,e,n,r;r=arguments[0],n=arguments[1],t=3<=arguments.length?k.call(arguments,2):[];e=l();if(typeof r==="function"){n=arguments[0],r=arguments[1]}setTimeout(function(r){return function(){return e.close(n!=null?n.apply(r,t):void 0)}}(this),r);return e.out()};_=function(){return y(E.apply(null,arguments))};o({single:"promise"},l);o({receive:"get take",send:"put",select:"alts"},b,e.exports={proc:v,chan:l,go:c,receive:y,send:m,select:b,poll:g,offer:d,timeout:E,sleep:_})}).call(this)},{"./buffer":2,"./callback":3,"./channel":4,"./helpers":5,"./process":7,"./selector":9}]},{},[10])(10)});